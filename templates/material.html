<!DOCTYPE html>
<html>
<head>
    <title>Материалы</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        table {
            width: 100%;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
<h1>Материалы</h1>
<table id="materials-table" class="table">
    <thead>
    <tr>
        <th>Название</th>
        <th>Количество</th>
        <th>Производство</th>
    </tr>
    </thead>
    <tbody>
    <!-- Здесь будут материалы -->
    </tbody>
</table>
<!-- Одна общая кнопка для производства -->
<button id="produce-button">Производство</button>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    function refreshMaterials() {
        $.getJSON('/api/materials', function (data) {
            data.forEach(function (material) {
                if ($('#material-' + material.id).length === 0) {
                    var row = '<tr id="material-' + material.id + '"><td>' + material.name + '</td><td class="count"></td><td>' +
                        '<input type="number" class="produce-input" data-id="' + material.id + '" name="count" min="1">' +
                        '</td></tr>';
                    $('#materials-table tbody').append(row);
                }
                $('#material-' + material.id + ' .count').text(material.count);
            });
        });
    }

    setInterval(refreshMaterials, 1000);  // Обновляйте каждую секунду

    $('#produce-button').click(function () {
        // Собираем данные из всех полей ввода
        var data = $('.produce-input').map(function () {
            return {
                id: $(this).data('id'),
                count: $(this).val()
            };
        }).get();

        // Отправляем данные на сервер
        data.forEach(function (item) {
            $.post('/api/materials/' + item.id + '/produce', {count: item.count});
        });

        // Очищаем все поля ввода
        $('.produce-input').val('');

        // Обновляем материалы
        refreshMaterials();
    });

    setInterval(refreshMaterials, 500); // обновляем каждые 5 секунд
    refreshMaterials(); // обновляем сразу при загрузке страницы
</script>
</body>
</html>