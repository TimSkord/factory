<!DOCTYPE html>
<html>
<head>
    <title>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        table {
            width: 100%;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        #produce-button {
            cursor: pointer;
            padding: 10px 20px;
            border: none;
            color: white;
            background-color: #007BFF;
            border-radius: 4px;
            transition: background-color 0.3s ease;
            font-weight: bold;
        }

        #produce-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
<h1>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</h1>
<table id="materials-table" class="table">
    <thead>
    <tr>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
        <th>–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
    </tr>
    </thead>
    <tbody>
    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
    </tbody>
</table>
<!-- –û–¥–Ω–∞ –æ–±—â–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ -->
<br>
<button id="produce-button">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

    var previousCounts = {};

    function refreshMaterials() {
        $.getJSON('/api/materials', function (data) {
            data.forEach(function (material) {
                if ($('#material-' + material.id).length === 0) {
                    var row = '<tr id="material-' + material.id + '"><td>' + material.name + '</td><td class="count"></td><td>' +
                        '<input type="number" class="produce-input" data-id="' + material.id + '" name="count" min="1">' +
                        '</td><td class="status"></td></tr>';
                    $('#materials-table tbody').append(row);
                }
                var currentCount = parseFloat($('#material-' + material.id + ' .count').text());
                $('#material-' + material.id + ' .count').text(material.count);

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                var statusElement = $('#material-' + material.id + ' .status');
                if (material.count <= 0) {
                    statusElement.text('üî¥').css('color', 'red');
                } else if (previousCounts[material.id] && material.status) {
                    statusElement.text('üü¢').css('color', 'green');
                } else if (previousCounts[material.id] && material.count < previousCounts[material.id]) {
                    statusElement.text('üî¥').css('color', 'red');
                } else {
                    statusElement.text('üü°').css('color', 'yellow');
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ count –¥–ª—è —ç—Ç–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                previousCounts[material.id] = currentCount;
            });
        });
    }

    setInterval(refreshMaterials, 1000);  // –û–±–Ω–æ–≤–ª—è–π—Ç–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

    $('#produce-button').click(function () {
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        var data = $('.produce-input').map(function () {
            return {
                id: $(this).data('id'),
                count: $(this).val()
            };
        }).get();

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        data.forEach(function (item) {
            $.post('/api/materials/' + item.id + '/produce', {count: item.count});
        });

        // –û—á–∏—â–∞–µ–º –≤—Å–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
        $('.produce-input').val('');

        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
        refreshMaterials();
    });

    setInterval(refreshMaterials, 500); // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    refreshMaterials(); // –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
</script>
</body>
</html>